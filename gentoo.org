* gentoo linux インストール

** passwd

** useradd -m -G users shun

** passwd shun

** ping -c 3 www.gentoo.org

** parted -a optimal /dev/sda
*** (parted)mklabel gpt
*** (parted)rm 2
*** (parted)unit mib
*** (parted)mkpart primary 1 3
*** (parted)name 1 grub
*** (parted)set 1 bios_grub on
*** (parted)print
    Model: Virtio Block Device (virtblk)
    Disk /dev/sda: 20480MiB
    Sector size (logical/physical): 512B/512B
    Partition Table: gpt
  
    Number   Start      End      Size     File system  Name   Flags
    1       1.00MiB    3.00MiB  2.00MiB               grub   bios_grub
*** (parted)mkpart primary 3 131
*** (parted)name 2 boot
*** (parted)mkpart primary 131 643
*** (parted)name 3 swap
*** (parted)mkpart primary 643 -1
*** (parted)name 4 rootfs
*** (parted)set 2 boot on
*** (parted)print
    Model: Virtio Block Device (virtblk)
    Disk /dev/sda: 20480MiB
    Sector size (logical/physical): 512B/512B
    Partition Table: gpt
  
    Number   Start      End      Size     File system  Name   Flags
    1       1.00MiB    3.00MiB  2.00MiB               grub   bios_grub
    2       3.00MiB    131MiB   128MiB                boot   boot
    3       131MiB     643MiB   512MiB                swap
    4       643MiB     20479MiB 19836MiB              rootfs
*** (parted)quit

** mkfs.ext2 /dev/sda2

** mkfs.ext4 /dev/sda4

** mkswap /dev/sda3

** swapon /dev/sda3

** mount /dev/sda4 /mnt/gentoo

** mkdir /mnt/gentoo/boot

** mount /dev/sda2 /mnt/gentoo/boot

** cd /mnt/gentoo

** links https://www.gentoo.org/downloads/mirrors/

** releases/amd64/autobuilds

** tar xvjpf stage3-*.tar.bz2 --xattrs

** nano -w /mnt/gentoo/etc/portage/make.conf
*** 追加
    - CFLAGS="-march=native -O2 -pipe"
    - MAKEOPTS="-j2"

** mirrorselect -i -o >> /mnt/gentoo/etc/portage/make.conf

** mkdir /mnt/gentoo/etc/portage/repos.conf

** cp /mnt/gentoo/usr/share/portage/config/repos.conf /mnt/gentoo/etc/portage/repos.conf/gentoo.conf

** cp -L /etc/resolv.conf /mnt/gentoo/etc/

** mount -t proc proc /mnt/gentoo/proc

** mount --rbind /sys /mnt/gentoo/sys

** mount --make-rslave /mnt/gentoo/sys

** mount --rbind /dev /mnt/gentoo/dev

** mount --make-rslave /mnt/gentoo/dev

** chroot /mnt/gentoo /bin/bash

** source /etc/profile

** export PS1="(chroot) $PS1"

** emerge-webrsync

** eselect profile list

** eselect profile set 2

** emerge --info | grep ^USE

** ls /usr/share/zoneinfo

** echo "Asia/Tokyo" > /etc/timezone

** emerge --config sys-libs/timezone-data

** nano -w /etc/locale.gen
*** コメントアウト
**** en_US.UTF-8 UTF-8
**** ja_JP.UTF-8 UTF-8

** locale-gen

** eselect locale list

** eselect locale set 3

** env-update && source /etc/profile && export PS1="(chroot) $PS1"

** emerge --ask sys-kernel/gentoo-sources

** ls -l /usr/src/linux
   lrwxrwxrwx    1 root   root    12 Oct 13 11:04 /usr/src/linux -> linux-3.16.5-gentoo

** emerge --ask sys-apps/pciutils

** cd /usr/src/linux

** マニュアル
*** make menuconfig
    Device Drivers --->
      Generic Driver Options --->
        [*] Maintain a devtmpfs filesystem to mount at /dev
        [ ]   Automount devtmpfs at /dev, after the kernel mounted the rootfs
    File systems --->
    (Select one or more of the following options as needed by your system)
      <*> Second extended fs support
      <*> Ext3 journalling file system support
      <*> The Extended 4 (ext4) filesystem
      <*> Reiserfs support
      <*> JFS filesystem support
      <*> XFS filesystem support
      ...
      Pseudo Filesystems --->
        [*] /proc file system support
        [*] Virtual memory file system support (former shm fs)
    Processor type and features  --->
      [*] Symmetric multi-processing support

*** make && make modules_install

*** make install

** 自動
*** emerge --ask sys-kernel/genkernel

*** nano -w /etc/fstab
**** /dev/sda2	/boot	ext2	defaults	0 2

*** genkernel all

*** ls /boot/kernel* /boot/initramfs*

*** カーネルとinitrdの名前をメモ
    - /boot/initramfs-genkernel-x86_64-4.4.6-gentoo
    - /boot/kernel-genkernel-x86_64-4.4.6-gentoo

** find /lib/modules/<kernel version>/ -type f -iname '*.o' -or -iname '*.ko' | less

** nano -w /etc/conf.d/modules
   - modules="3c59x"

** emerge --ask sys-kernel/linux-firmware

** nano -w /etc/fstab
   /dev/sda2   /boot        ext2    defaults,noatime     0 2
   /dev/sda3   none         swap    sw                   0 0
   /dev/sda4   /            ext4    noatime              0 1
  
   /dev/cdrom  /mnt/cdrom   auto    noauto,user          0 0

** nano -w /etc/conf.d/hostname
   - ex) hostname="tux"

** nano -w /etc/conf.d/net
   - ex) dns_domain_lo="homenetwork"

** emerge --ask --noreplace net-misc/netifrc

** nano -w /etc/conf.d/net
   - config_eth0="192.168.0.2 netmask 255.255.255.0 brd 192.168.0.255"
   - routes_eth0="default via 192.168.0.1"
   - config_eth0="dhcp"

** cd /etc/init.d

** ln -s net.lo net.eth0

** rc-update add net.eth0 default

** nano -w /etc/hosts
   - 127.0.0.1     tux.homenetwork tux localhost

** passwd

** nano -w /etc/rc.conf

** nano -w /etc/conf.d/keymaps

** nano -w /etc/conf.d/hwclock

** rc-update add sshd default

** emerge --ask sys-boot/grub:2

** emerge --ask --update --newuse --verbose --ask sys-boot/grub:2

** grub2-install /dev/sda

** grub2-mkconfig -o /boot/grub/grub.cfg

** exit

** cd

** umount -l /mnt/gentoo/dev{/shm,/pts,}

** umount /mnt/gentoo{/boot,/sys,/proc,}

** reboot


              [2016-04-27 22:02] 

